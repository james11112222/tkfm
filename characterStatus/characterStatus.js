function calculate(e){let a=0,r=0;var l=CHARACTERS[e.find(".char").val()],t=parseInt(e.find(".lv").val()),n=parseInt(e.find(".star").val()),o=parseInt(e.find(".discipline").val());try{for(let t=e.find(".potential").val()-1;1<=t;t--)a+=$.map(POTENTIALS[l.potentialType][t],(t,e)=>{if("atk"==t.type)return t.buff}).reduce((t,e)=>t+e,0),r+=$.map(POTENTIALS[l.potentialType][t],(t,e)=>{if("hp"==t.type)return t.buff}).reduce((t,e)=>t+e,0);e.find(".subPot:checked").map((t,e)=>e.value).get().forEach(t=>{t=POTENTIALS[l.potentialType][e.find(".potential").val()][t];"atk"==t.type?a+=t.buff:"hp"==t.type&&(r+=t.buff)}),e.find(".resultAtk").text(Math.floor(Math.ceil(l.status.initATK/(5+l.rarity)*10)/10*(5+n)*Math.pow(1.1,t-1)*(1+(1+o)*o/2*.05)*(1+a))),e.find(".resultHp").text(Math.floor(Math.ceil(l.status.initHP/(5+l.rarity)*10)/10*(5+n)*Math.pow(1.1,t-1)*(1+(1+o)*o/2*.05)*(1+r)))}catch(t){errorAlert()}}function errorAlert(){alert("有地方出錯了，叫那個低能作者儘快修復")}$(function(){try{$(".charDiv").each((t,e)=>{let a=$(e);a.find(".char").append($("<optgroup label='SSR'>"),$("<optgroup label='SR'>"),$("<optgroup label='R'>"),$("<optgroup label='N'>")),$.each(CHARACTERS,(t,e)=>{switch(e.rarity){case 3:a.find("optgroup[label='SSR']").append($("<option>",{value:t,text:e.name}));break;case 2:a.find("optgroup[label='SR']").append($("<option>",{value:t,text:e.name}));break;case 1:a.find("optgroup[label='R']").append($("<option>",{value:t,text:e.name}));break;default:a.find("optgroup[label='N']").append($("<option>",{value:t,text:e.name}))}});for(let t=1;t<=60;t++)a.find(".lv").append($("<option>",{value:t,text:t}))})}catch(t){errorAlert()}$(document).on("change",".char",t=>{let e=$(t.currentTarget),a=e.closest(".charDiv").find(".star"),r=e.closest(".charDiv").find(".discipline"),l=e.closest(".charDiv").find(".potential");var n=CHARACTERS[e.val()];try{a.empty(),r.empty(),l.empty();for(let t=n.rarity;t<=5;t++)a.append($("<option>",{value:t,text:t}));for(let t=1;t<=(n.rarity<2?6:12);t++)l.append($("<option>",{value:t,text:t}));if(n.rarity<1)r.append($("<option>",{value:0,text:"-"})).attr("disabled",!0);else for(let t=0;t<=3;t++)r.append($("<option>",{value:t,text:t}));calculate(e.closest(".charDiv"))}catch(t){errorAlert()}}),$(".char").change(),$(document).on("change",".potential",t=>{let e=$(t.currentTarget);var a=e.closest(".charDiv").find(".char").val();try{for(let t=1;t<=6;t++)e.siblings().find("input:eq("+(t-1)+")").attr("class","subPot form-check-input pointer "+POTENTIALS[CHARACTERS[a].potentialType][e.val()][t].type+"Pot");calculate(e.closest(".charDiv"))}catch(t){errorAlert()}}),$(".potential").change(),$(document).on("change",".subPot, .lv, .star, .discipline",t=>{let e=$(t.currentTarget);calculate(e.closest(".charDiv"))})});